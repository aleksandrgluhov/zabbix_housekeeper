# Zabbix Partitioning Housekeeper

Скрипт позволяет организовать автоматическую "ротацию" предварительно подготовленных партиций таблиц БД Zabbix. Партиции мы настраиваем по полю `clock` вручную, а потом вешаем этот скрипт cron задачей на каждую полночь.

### Примеры запросов для подготовки таблиц:

ALTER TABLE `history_uint` PARTITION BY RANGE (clock)
(PARTITION p2017_10_01 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-02 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_02 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-03 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_03 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-04 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_04 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-05 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_05 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-06 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_06 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-07 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_07 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-08 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_08 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-09 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_09 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-10 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_10 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-11 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_11 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-12 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_12 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-13 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_13 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-14 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_14 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-15 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_15 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-16 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_16 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-17 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_17 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-18 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_18 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-19 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_19 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-20 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_20 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-21 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_21 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-22 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_22 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-23 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_23 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-24 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_24 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-25 00:00:00")) ENGINE = InnoDB);


ALTER TABLE `history_text` PARTITION BY RANGE (clock)
(PARTITION p2017_10_01 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-02 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_02 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-03 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_03 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-04 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_04 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-05 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_05 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-06 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_06 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-07 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_07 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-08 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_08 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-09 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_09 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-10 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_10 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-11 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_11 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-12 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_12 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-13 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_13 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-14 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_14 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-15 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_15 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-16 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_16 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-17 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_17 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-18 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_18 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-19 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_19 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-20 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_20 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-21 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_21 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-22 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_22 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-23 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_23 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-24 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_24 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-25 00:00:00")) ENGINE = InnoDB);


ALTER TABLE `history_str` PARTITION BY RANGE (clock)
(PARTITION p2017_10_01 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-02 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_02 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-03 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_03 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-04 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_04 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-05 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_05 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-06 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_06 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-07 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_07 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-08 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_08 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-09 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_09 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-10 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_10 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-11 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_11 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-12 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_12 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-13 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_13 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-14 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_14 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-15 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_15 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-16 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_16 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-17 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_17 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-18 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_18 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-19 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_19 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-20 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_20 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-21 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_21 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-22 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_22 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-23 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_23 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-24 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_24 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-25 00:00:00")) ENGINE = InnoDB);


ALTER TABLE `history_log` PARTITION BY RANGE (clock)
(PARTITION p2017_10_01 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-02 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_02 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-03 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_03 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-04 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_04 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-05 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_05 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-06 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_06 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-07 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_07 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-08 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_08 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-09 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_09 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-10 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_10 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-11 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_11 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-12 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_12 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-13 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_13 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-14 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_14 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-15 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_15 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-16 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_16 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-17 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_17 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-18 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_18 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-19 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_19 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-20 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_20 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-21 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_21 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-22 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_22 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-23 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_23 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-24 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_24 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-25 00:00:00")) ENGINE = InnoDB);


ALTER TABLE `history` PARTITION BY RANGE (clock)
(PARTITION p2017_10_01 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-02 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_02 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-03 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_03 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-04 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_04 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-05 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_05 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-06 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_06 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-07 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_07 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-08 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_08 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-09 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_09 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-10 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_10 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-11 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_11 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-12 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_12 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-13 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_13 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-14 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_14 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-15 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_15 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-16 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_16 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-17 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_17 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-18 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_18 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-19 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_19 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-20 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_20 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-21 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_21 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-22 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_22 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-23 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_23 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-24 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_24 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-25 00:00:00")) ENGINE = InnoDB);


ALTER TABLE `events` PARTITION BY RANGE (clock)
(PARTITION p2017_10_01 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-02 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_02 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-03 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_03 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-04 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_04 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-05 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_05 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-06 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_06 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-07 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_07 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-08 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_08 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-09 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_09 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-10 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_10 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-11 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_11 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-12 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_12 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-13 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_13 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-14 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_14 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-15 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_15 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-16 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_16 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-17 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_17 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-18 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_18 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-19 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_19 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-20 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_20 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-21 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_21 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-22 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_22 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-23 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_23 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-24 00:00:00")) ENGINE = InnoDB,
 PARTITION p2017_10_24 VALUES LESS THAN (UNIX_TIMESTAMP("2017-10-25 00:00:00")) ENGINE = InnoDB);


